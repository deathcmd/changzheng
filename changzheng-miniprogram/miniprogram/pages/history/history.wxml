<!--pages/history/history.wxml-->
<view class="container">
  <!-- æœªç™»å½•æç¤º -->
  <view class="login-tip" wx:if="{{!isLogin}}">
    <text class="tip-icon">ğŸ”’</text>
    <text class="tip-text">ç™»å½•åæŸ¥çœ‹è¿åŠ¨è®°å½•</text>
    <button class="login-btn" bindtap="goLogin">ç«‹å³ç™»å½•</button>
  </view>

  <block wx:else>
    <!-- ç»Ÿè®¡æ¦‚è§ˆ -->
    <view class="stats-card">
      <view class="stats-header">
        <text class="stats-title">{{currentMonth}} è¿åŠ¨ç»Ÿè®¡</text>
      </view>
      <view class="stats-grid">
        <view class="stats-item">
          <text class="stats-value">{{totalSteps}}</text>
          <text class="stats-label">æ€»æ­¥æ•°</text>
        </view>
        <view class="stats-item">
          <text class="stats-value">{{totalMileage}}</text>
          <text class="stats-label">æ€»é‡Œç¨‹(km)</text>
        </view>
        <view class="stats-item">
          <text class="stats-value">{{totalDays}}</text>
          <text class="stats-label">è¿åŠ¨å¤©æ•°</text>
        </view>
        <view class="stats-item">
          <text class="stats-value">{{avgSteps}}</text>
          <text class="stats-label">æ—¥å‡æ­¥æ•°</text>
        </view>
      </view>
    </view>

    <!-- æ¢ç®—è¯´æ˜ -->
    <view class="convert-tip">
      <text class="tip-icon">ğŸ’¡</text>
      <text>æ¢ç®—è§„åˆ™ï¼š{{stepToKmRate}} æ­¥ = 1 å…¬é‡Œ</text>
    </view>

    <!-- è®°å½•åˆ—è¡¨ -->
    <view class="record-list">
      <view class="list-header">
        <text class="list-title">æ¯æ—¥è®°å½•</text>
      </view>

      <view class="loading-tip" wx:if="{{loading}}">
        <text>åŠ è½½ä¸­...</text>
      </view>

      <block wx:else>
        <view 
          class="record-item" 
          wx:for="{{records}}" 
          wx:key="id"
          data-record="{{item}}"
          bindtap="onRecordTap"
        >
          <view class="record-date">
            <text class="date-text">{{item.dateText}}</text>
            <text class="week-text">{{item.weekDay}}</text>
          </view>
          <view class="record-data">
            <view class="data-row">
              <text class="data-icon">ğŸ‘Ÿ</text>
              <text class="data-value">{{item.steps}}</text>
              <text class="data-unit">æ­¥</text>
            </view>
            <view class="data-row">
              <text class="data-icon">ğŸ“</text>
              <text class="data-value">{{item.mileage}}</text>
              <text class="data-unit">km</text>
            </view>
          </view>
          <view class="record-arrow">â€º</view>
        </view>

        <view class="list-footer" wx:if="{{records.length >= 30}}">
          <text>â€” ä»…æ˜¾ç¤ºæœ€è¿‘30å¤©è®°å½• â€”</text>
        </view>
      </block>
    </view>
  </block>
</view>
