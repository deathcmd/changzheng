<!--pages/node/node.wxml-->
<view class="container">
  <!-- åŠ è½½ä¸­ -->
  <view class="loading-state" wx:if="{{loading}}">
    <view class="loading-icon"></view>
    <text>åŠ è½½ä¸­...</text>
  </view>

  <block wx:else>
    <!-- èŠ‚ç‚¹å°é¢ -->
    <view class="node-header">
      <view class="node-overlay"></view>
      <view class="node-info">
        <text class="node-name">{{nodeInfo.nodeName}}</text>
        <text class="node-km">é‡Œç¨‹ï¼š{{nodeInfo.mileageThreshold || nodeInfo.km || 0}} km</text>
      </view>
    </view>

    <!-- èŠ‚ç‚¹æè¿° -->
    <view class="node-desc card">
      <view class="section-title">å†å²èƒŒæ™¯</view>
      <text class="desc-text">{{nodeInfo.description || 'æš‚æ— æè¿°'}}</text>
    </view>

    <!-- å­¦ä¹ è¿›åº¦ -->
    <view class="progress-section card" wx:if="{{contents.length > 0}}">
      <view class="progress-header">
        <text class="section-title">å­¦ä¹ å†…å®¹</text>
        <text class="progress-text">{{learnedCount}}/{{totalCount}}</text>
      </view>
      <view class="progress-bar">
        <view class="progress-fill" style="width: {{progressPercent}}%"></view>
      </view>
    </view>

    <!-- å†…å®¹åˆ—è¡¨ -->
    <view class="content-list" wx:if="{{contents.length > 0}}">
      <view 
        class="content-item {{item.isLearned ? 'learned' : ''}}"
        wx:for="{{contents}}"
        wx:key="id"
        data-item="{{item}}"
        bindtap="onContentTap"
      >
        <view class="content-left">
          <view class="content-type-icon">
            <text wx:if="{{item.contentType === 'video'}}">ğŸ¥</text>
            <text wx:elif="{{item.contentType === 'audio'}}">ğŸ™ï¸</text>
            <text wx:elif="{{item.contentType === 'quiz'}}">â“</text>
            <text wx:else>ğŸ“–</text>
          </view>
          <view class="content-info">
            <text class="content-title">{{item.title}}</text>
            <view class="content-meta">
              <text class="meta-type">{{item.contentType === 'video' ? 'è§†é¢‘' : item.contentType === 'audio' ? 'éŸ³é¢‘' : item.contentType === 'quiz' ? 'ç­”é¢˜' : 'å›¾æ–‡'}}</text>
              <text class="meta-duration" wx:if="{{item.duration}}">{{item.duration}}</text>
            </view>
          </view>
        </view>
        <view class="content-right">
          <text class="learned-badge" wx:if="{{item.isLearned}}">âœ“</text>
          <text wx:else class="arrow-icon">â€º</text>
        </view>
      </view>
    </view>

    <!-- ç©ºçŠ¶æ€ -->
    <view class="empty-content card" wx:if="{{contents.length === 0}}">
      <text class="empty-icon">ğŸ“š</text>
      <text class="empty-text">æš‚æ— å­¦ä¹ å†…å®¹</text>
      <text class="empty-hint">æ•¬è¯·æœŸå¾…</text>
    </view>

    <!-- åˆ†äº«æŒ‰é’® -->
    <view class="share-section">
      <button class="share-btn" open-type="share">
        <text>ğŸš€ åˆ†äº«æˆ‘çš„é•¿å¾è¶³è¿¹</text>
      </button>
    </view>
  </block>
</view>
