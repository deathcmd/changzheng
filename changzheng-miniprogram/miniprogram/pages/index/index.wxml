<!--pages/index/index.wxml-->
<view class="container">
  <!-- é¡¶éƒ¨å¤´åƒåŒºåŸŸ -->
  <view class="header">
    <view class="header-bg"></view>
    <view class="header-content">
      <!-- å­¦é™¢ä¿¡æ¯ -->
      <view class="school-badge">
        <text class="school-name">å››å·å·¥å•†èŒä¸šæŠ€æœ¯å­¦é™¢ Â· æ™ºèƒ½åˆ¶é€ ä¸ä¿¡æ¯å·¥ç¨‹å­¦é™¢</text>
      </view>
      
      <!-- ç”¨æˆ·ä¿¡æ¯ -->
      <view class="user-section" wx:if="{{isLogin}}">
        <view class="avatar-lg">
          <image wx:if="{{userInfo.avatarUrl}}" class="avatar-img" src="{{userInfo.avatarUrl}}" mode="aspectFill"/>
          <text wx:else>{{userInfo.nickName ? userInfo.nickName[0] : 'æˆ˜'}}</text>
        </view>
        <view class="user-info">
          <text class="nickname">{{userInfo.nickName || 'é•¿å¾æˆ˜å£«'}}</text>
          <text class="student-id" wx:if="{{userInfo.studentId}}">å­¦å·ï¼š{{userInfo.studentId}}</text>
        </view>
      </view>
      
      <!-- æœªç™»å½• -->
      <view class="login-section" wx:else>
        <view class="login-btn" bindtap="goLogin">
          <text>ç‚¹å‡»ç™»å½•ï¼Œå¼€å¯é•¿å¾ä¹‹æ—…</text>
        </view>
      </view>
    </view>
  </view>

  <!-- ä»Šæ—¥æ•°æ®å¡ç‰‡ -->
  <view class="data-card">
    <view class="data-item">
      <view class="data-value">{{todaySteps || 0}}</view>
      <view class="data-label">ä»Šæ—¥æ­¥æ•°</view>
    </view>
    <view class="data-divider"></view>
    <view class="data-item">
      <view class="data-value">{{todayMileage || '0.00'}}</view>
      <view class="data-label">ä»Šæ—¥é‡Œç¨‹(km)</view>
    </view>
    <view class="data-divider"></view>
    <view class="data-item">
      <view class="data-value text-primary">{{totalMileage || '0.00'}}</view>
      <view class="data-label">ç´¯è®¡é‡Œç¨‹(km)</view>
    </view>
  </view>

  <!-- åŒæ­¥çŠ¶æ€ -->
  <view class="sync-section">
    <view class="sync-status">
      <text class="sync-icon">âœ…</text>
      <text class="sync-text">å·²è‡ªåŠ¨åŒæ­¥å¾®ä¿¡è¿åŠ¨æ­¥æ•°</text>
    </view>
    <button class="sync-btn-small" bindtap="onSyncTap" disabled="{{syncing}}">
      <text>{{syncing ? 'åŒæ­¥ä¸­...' : 'ç«‹å³åˆ·æ–°'}}</text>
    </button>
  </view>

  <!-- å½“å‰è¿›åº¦ -->
  <view class="progress-card" wx:if="{{currentNode}}">
    <view class="progress-header">
      <text class="progress-title">å½“å‰ä½ç½®</text>
      <text class="progress-detail" bindtap="goMap">æŸ¥çœ‹åœ°å›¾ ></text>
    </view>
    
    <view class="node-info" bindtap="goCurrentNode">
      <view class="node-icon">ğŸ“</view>
      <view class="node-detail">
        <text class="node-name">{{currentNode.nodeName}}</text>
        <text class="node-desc">å·²å®Œæˆ {{progressPercent}}%</text>
      </view>
      <view class="node-arrow">â€º</view>
    </view>
    
    <!-- è¿›åº¦æ¡ -->
    <view class="progress-bar">
      <view class="progress-fill" style="width: {{progressPercent}}%"></view>
    </view>
    
    <!-- ä¸‹ä¸€èŠ‚ç‚¹ -->
    <view class="next-node" wx:if="{{nextNode}}">
      <text class="next-label">è·ç¦»ä¸‹ä¸€ç«™ã€{{nextNode.nodeName}}ã€‘è¿˜éœ€</text>
      <text class="next-distance">{{nextNode.remainingMileage || nextNode.remainingKm || 0}} km</text>
    </view>
  </view>

  <!-- å¿«æ·å…¥å£ -->
  <view class="quick-entry">
    <view class="entry-item" bindtap="goMap">
      <view class="entry-icon">ğŸ—ºï¸</view>
      <text>é•¿å¾åœ°å›¾</text>
    </view>
    <view class="entry-item" bindtap="goRank">
      <view class="entry-icon">ğŸ†</view>
      <text>æ’è¡Œæ¦œ</text>
      <view class="rank-badge" wx:if="{{myRank > 0 && myRank <= 100}}">ç¬¬{{myRank}}å</view>
    </view>
    <view class="entry-item" bindtap="goAchievement">
      <view class="entry-icon">ğŸ–ï¸</view>
      <text>æˆ‘çš„æˆå°±</text>
    </view>
    <view class="entry-item" bindtap="goHistory">
      <view class="entry-icon">ğŸ“Š</view>
      <text>è¿åŠ¨è®°å½•</text>
    </view>
  </view>

  <!-- é•¿å¾æ•…äº‹ -->
  <view class="story-section">
    <view class="section-header">
      <text class="section-title">é•¿å¾æ•…äº‹</text>
      <text class="section-more">æ›´å¤š ></text>
    </view>
    <view class="story-list">
      <view class="story-item">
        <view class="story-cover">ğŸš©</view>
        <view class="story-info">
          <text class="story-title">çº¢å†›é•¿å¾çš„ä¼Ÿå¤§æ„ä¹‰</text>
          <text class="story-desc">é•¿å¾æ˜¯äººç±»å†å²ä¸Šçš„ä¼Ÿå¤§å¥‡è¿¹...</text>
        </view>
      </view>
    </view>
  </view>
</view>
