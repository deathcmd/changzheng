import{_ as we}from"./_plugin-vue_export-helper-DRcqrMy4.js";/* empty css                        *//* empty css                 *//* empty css                 *//* empty css                   *//* empty css               *//* empty css                *//* empty css                  */import{r as c,a as h,d as ke,N as Ve,C as U,D as n,F as l,k as E,G as a,I as Ce,ax as Ee,l as f,S as O,T,ay as xe,K as Ne,L as u,V as Be,u as $,az as je,aq as ze,ar as Ue,aA as Re,aB as De,ad as Se,ac as he,X as _,ae as $e,af as Fe,ag as Le,ah as Ie,ai as Oe,Q as G,aj as Te,aC as Me,ap as Pe,aw as Ae,aD as qe,am as He,M as Ke,H as Qe,aE as Xe,E as v,y as ee,aF as Je}from"./element-plus-DOarM9kH.js";import{r as x}from"./index-aAsznUlZ.js";function We(b){return x({url:"/admin/students",method:"get",params:b})}function Ye(){return x({url:"/admin/students/stats",method:"get"})}function Ze(b){const w=new FormData;return w.append("file",b),x({url:"/admin/students/import",method:"post",data:w,headers:{"Content-Type":"multipart/form-data"}})}function Ge(b,w){return x({url:`/admin/students/${b}`,method:"put",data:w})}function el(b){return x({url:`/admin/students/${b}`,method:"delete"})}function ll(b){return x({url:`/admin/students/${b}/unbind`,method:"post"})}const al={class:"student-list"},tl={class:"filter-row"},sl={class:"filter-left"},ol={class:"filter-right"},nl={class:"stat-value"},dl={class:"stat-value"},ul={class:"stat-value"},il={class:"stat-value"},rl={class:"pagination-wrapper"},pl={key:1,class:"class-view"},ml={class:"class-header"},fl={class:"class-info"},cl={class:"class-name"},_l={class:"class-major"},vl={class:"class-stats"},bl={class:"import-tips"},gl={__name:"list",setup(b){const w=c("list"),d=h({keyword:"",major:"",className:"",isBound:null}),le=c(["软件技术","计算机应用技术","大数据技术","物联网应用技术","人工智能技术应用"]),ae=c(["软件2301","软件2302","软件2303","计应2301","计应2302","大数据2301","物联网2301"]),M=c([]),N=h({total:0,bound:0,unbound:0,bindRate:0}),P=c([]),F=c(!1),g=h({page:1,size:20,total:0}),B=c(!1),te=c(null),R=c(null),L=c(!1),j=c(!1),i=h({id:null,studentNo:"",name:"",gender:"",major:"",className:"",grade:"",phone:""}),se=ke(()=>{const s={};return M.value.filter(o=>!(d.keyword&&!o.studentNo.includes(d.keyword)&&!o.name.includes(d.keyword)||d.major&&o.major!==d.major||d.className&&o.className!==d.className||d.isBound!==null&&o.isBound!==d.isBound)).forEach(o=>{const r=o.className||"未分班";s[r]||(s[r]={className:r,major:o.major,students:[],total:0,bound:0,unbound:0,bindRate:0}),s[r].students.push(o),s[r].total++,o.isBound?s[r].bound++:s[r].unbound++}),Object.values(s).forEach(o=>{o.bindRate=o.total>0?Math.round(o.bound/o.total*100):0}),Object.values(s).sort((o,r)=>o.className.localeCompare(r.className))}),k=async()=>{F.value=!0;try{const[s,e]=await Promise.all([We({page:g.page,size:g.size,keyword:d.keyword,major:d.major,className:d.className,isBound:d.isBound}),Ye()]);P.value=s.data.records,M.value=s.data.records,g.total=s.data.total,Object.assign(N,e.data)}catch(s){console.error("加载数据失败",s),v.error("加载数据失败")}finally{F.value=!1}},A=()=>{g.page=1,k()},oe=()=>{d.keyword="",d.major="",d.className="",d.isBound=null,A()},ne=()=>{g.page=1,k()},de=()=>{k()},ue=()=>{R.value=null,B.value=!0},ie=s=>{R.value=s.raw},re=()=>{const s=`学号,姓名,性别,专业,班级,年级,手机号
20230001,张三,男,软件技术,软件2301,2023级,13800000001
20230002,李四,女,计算机应用技术,计应2301,2023级,13800000002`,e=new Blob(["\uFEFF"+s],{type:"text/csv;charset=utf-8"}),o=URL.createObjectURL(e),r=document.createElement("a");r.href=o,r.download="学生信息导入模板.csv",r.click(),URL.revokeObjectURL(o),v.success("模板下载成功，请使用Excel打开编辑")},pe=async()=>{if(!R.value){v.warning("请选择要导入的文件");return}L.value=!0;try{const s=await Ze(R.value);v.success(`导入成功！共导入 ${s.data.successCount} 条学生信息`),B.value=!1,k()}catch(s){console.error("导入失败",s),v.error("导入失败")}finally{L.value=!1}},q=s=>{Object.assign(i,s),j.value=!0},me=async()=>{try{await Ge(i.id,i),v.success("保存成功"),j.value=!1,k()}catch(s){console.error("保存失败",s),v.error("保存失败")}},H=async s=>{await ee.confirm(`确定要解除 ${s.name} 的绑定吗？解绑后该学生需要重新认证`,"解绑确认",{type:"warning"});try{await ll(s.id),v.success("解绑成功"),k()}catch(e){console.error("解绑失败",e),v.error("解绑失败")}},K=async s=>{await ee.confirm(`确定要删除学生 ${s.name} 吗？`,"删除确认",{type:"error"});try{await el(s.id),v.success("删除成功"),k()}catch(e){console.error("删除失败",e),v.error("删除失败")}};return Ve(()=>{k()}),(s,e)=>{const o=Ce,r=xe,I=Ee,D=Be,m=Ne,Q=Ue,X=ze,V=Se,S=he,fe=$e,p=Ie,z=Oe,J=Le,ce=Me,_e=Je,ve=Pe,be=Ae,W=He,C=Qe,Y=Xe,ge=Ke,ye=Te;return f(),U("div",al,[e[43]||(e[43]=n("div",{class:"page-header"},[n("h2",null,"学生信息管理"),n("p",{class:"sub-title"},"四川工商职业技术学院 · 智能制造与信息工程学院")],-1)),l(V,{class:"filter-card"},{default:a(()=>[n("div",tl,[n("div",sl,[l(o,{modelValue:d.keyword,"onUpdate:modelValue":e[0]||(e[0]=t=>d.keyword=t),placeholder:"学号/姓名",clearable:"",style:{width:"200px"}},null,8,["modelValue"]),l(I,{modelValue:d.major,"onUpdate:modelValue":e[1]||(e[1]=t=>d.major=t),placeholder:"专业",clearable:"",style:{width:"180px"}},{default:a(()=>[(f(!0),U(O,null,T(le.value,t=>(f(),E(r,{key:t,label:t,value:t},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),l(I,{modelValue:d.className,"onUpdate:modelValue":e[2]||(e[2]=t=>d.className=t),placeholder:"班级",clearable:"",style:{width:"180px"}},{default:a(()=>[(f(!0),U(O,null,T(ae.value,t=>(f(),E(r,{key:t,label:t,value:t},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),l(I,{modelValue:d.isBound,"onUpdate:modelValue":e[3]||(e[3]=t=>d.isBound=t),placeholder:"绑定状态",clearable:"",style:{width:"120px"}},{default:a(()=>[l(r,{label:"已绑定",value:1}),l(r,{label:"未绑定",value:0})]),_:1},8,["modelValue"]),l(m,{type:"primary",onClick:A},{default:a(()=>[l(D,null,{default:a(()=>[l($(je))]),_:1}),e[18]||(e[18]=u(" 查询 ",-1))]),_:1}),l(m,{onClick:oe},{default:a(()=>[...e[19]||(e[19]=[u("重置",-1)])]),_:1})]),n("div",ol,[l(X,{modelValue:w.value,"onUpdate:modelValue":e[4]||(e[4]=t=>w.value=t),size:"small",style:{"margin-right":"12px"}},{default:a(()=>[l(Q,{value:"list"},{default:a(()=>[...e[20]||(e[20]=[u("列表",-1)])]),_:1}),l(Q,{value:"class"},{default:a(()=>[...e[21]||(e[21]=[u("按班级",-1)])]),_:1})]),_:1},8,["modelValue"]),l(m,{type:"success",onClick:ue},{default:a(()=>[l(D,null,{default:a(()=>[l($(Re))]),_:1}),e[22]||(e[22]=u(" 导入学生 ",-1))]),_:1}),l(m,{onClick:re},{default:a(()=>[l(D,null,{default:a(()=>[l($(De))]),_:1}),e[23]||(e[23]=u(" 下载模板 ",-1))]),_:1})])])]),_:1}),l(fe,{gutter:20,class:"stats-row"},{default:a(()=>[l(S,{span:6},{default:a(()=>[l(V,{class:"stat-card"},{default:a(()=>[n("div",nl,_(N.total),1),e[24]||(e[24]=n("div",{class:"stat-label"},"总人数",-1))]),_:1})]),_:1}),l(S,{span:6},{default:a(()=>[l(V,{class:"stat-card bound"},{default:a(()=>[n("div",dl,_(N.bound),1),e[25]||(e[25]=n("div",{class:"stat-label"},"已绑定",-1))]),_:1})]),_:1}),l(S,{span:6},{default:a(()=>[l(V,{class:"stat-card unbound"},{default:a(()=>[n("div",ul,_(N.unbound),1),e[26]||(e[26]=n("div",{class:"stat-label"},"未绑定",-1))]),_:1})]),_:1}),l(S,{span:6},{default:a(()=>[l(V,{class:"stat-card rate"},{default:a(()=>[n("div",il,_(N.bindRate)+"%",1),e[27]||(e[27]=n("div",{class:"stat-label"},"绑定率",-1))]),_:1})]),_:1})]),_:1}),w.value==="list"?(f(),E(V,{key:0},{default:a(()=>[Fe((f(),E(J,{data:P.value,stripe:""},{default:a(()=>[l(p,{prop:"studentNo",label:"学号",width:"140"}),l(p,{prop:"name",label:"姓名",width:"100"}),l(p,{prop:"gender",label:"性别",width:"60","class-name":"hide-on-mobile"}),l(p,{prop:"major",label:"专业","min-width":"150"}),l(p,{prop:"className",label:"班级",width:"180"}),l(p,{prop:"grade",label:"年级",width:"100","class-name":"hide-on-mobile"}),l(p,{prop:"isBound",label:"绑定状态",width:"100"},{default:a(({row:t})=>[l(z,{type:t.isBound?"success":"info"},{default:a(()=>[u(_(t.isBound?"已绑定":"未绑定"),1)]),_:2},1032,["type"])]),_:1}),l(p,{prop:"boundAt",label:"绑定时间",width:"170","class-name":"hide-on-mobile"}),l(p,{label:"操作",width:"150",fixed:"right"},{default:a(({row:t})=>[l(m,{link:"",type:"primary",size:"small",onClick:y=>q(t)},{default:a(()=>[...e[28]||(e[28]=[u("编辑",-1)])]),_:1},8,["onClick"]),t.isBound?(f(),E(m,{key:0,link:"",type:"warning",size:"small",onClick:y=>H(t)},{default:a(()=>[...e[29]||(e[29]=[u("解绑",-1)])]),_:1},8,["onClick"])):G("",!0),l(m,{link:"",type:"danger",size:"small",onClick:y=>K(t)},{default:a(()=>[...e[30]||(e[30]=[u("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[ye,F.value]]),n("div",rl,[l(ce,{"current-page":g.page,"onUpdate:currentPage":e[5]||(e[5]=t=>g.page=t),"page-size":g.size,"onUpdate:pageSize":e[6]||(e[6]=t=>g.size=t),"page-sizes":[20,50,100],total:g.total,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:ne,onCurrentChange:de},null,8,["current-page","page-size","total"])])]),_:1})):(f(),U("div",pl,[(f(!0),U(O,null,T(se.value,t=>(f(),E(V,{key:t.className,class:"class-card"},{header:a(()=>[n("div",ml,[n("div",fl,[n("span",cl,_(t.className),1),n("span",_l,_(t.major),1)]),n("div",vl,[l(z,{type:"info",size:"small"},{default:a(()=>[u("共 "+_(t.total)+" 人",1)]),_:2},1024),l(z,{type:"success",size:"small"},{default:a(()=>[u("已认证 "+_(t.bound),1)]),_:2},1024),l(z,{type:"warning",size:"small"},{default:a(()=>[u("未认证 "+_(t.unbound),1)]),_:2},1024),l(_e,{percentage:t.bindRate,"stroke-width":8,style:{width:"100px","margin-left":"12px"}},null,8,["percentage"])])])]),default:a(()=>[l(J,{data:t.students,size:"small",stripe:""},{default:a(()=>[l(p,{prop:"studentNo",label:"学号",width:"130"}),l(p,{prop:"name",label:"姓名",width:"90"}),l(p,{prop:"gender",label:"性别",width:"60"}),l(p,{prop:"phone",label:"手机号",width:"130"}),l(p,{prop:"isBound",label:"认证状态",width:"100"},{default:a(({row:y})=>[l(z,{type:y.isBound?"success":"info",size:"small"},{default:a(()=>[u(_(y.isBound?"已认证":"未认证"),1)]),_:2},1032,["type"])]),_:1}),l(p,{prop:"boundAt",label:"认证时间","min-width":"160"}),l(p,{label:"操作",width:"150",fixed:"right"},{default:a(({row:y})=>[l(m,{link:"",type:"primary",size:"small",onClick:Z=>q(y)},{default:a(()=>[...e[31]||(e[31]=[u("编辑",-1)])]),_:1},8,["onClick"]),y.isBound?(f(),E(m,{key:0,link:"",type:"warning",size:"small",onClick:Z=>H(y)},{default:a(()=>[...e[32]||(e[32]=[u("解绑",-1)])]),_:1},8,["onClick"])):G("",!0),l(m,{link:"",type:"danger",size:"small",onClick:Z=>K(y)},{default:a(()=>[...e[33]||(e[33]=[u("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])]),_:2},1024))),128))])),l(W,{modelValue:B.value,"onUpdate:modelValue":e[8]||(e[8]=t=>B.value=t),title:"导入学生信息",width:"500px"},{footer:a(()=>[l(m,{onClick:e[7]||(e[7]=t=>B.value=!1)},{default:a(()=>[...e[37]||(e[37]=[u("取消",-1)])]),_:1}),l(m,{type:"primary",onClick:pe,loading:L.value},{default:a(()=>[...e[38]||(e[38]=[u(" 确认导入 ",-1)])]),_:1},8,["loading"])]),default:a(()=>[n("div",bl,[l(ve,{type:"info",closable:!1},{title:a(()=>[...e[34]||(e[34]=[n("p",null,"1. 请先下载导入模板，按格式填写学生信息",-1),n("p",null,"2. 必填字段：学号、姓名",-1),n("p",null,"3. 选填字段：性别、专业、班级、年级、手机号",-1),n("p",null,"4. 重复学号将自动更新信息",-1)])]),_:1})]),l(be,{ref_key:"uploadRef",ref:te,class:"upload-area",drag:"","auto-upload":!1,limit:1,accept:".xlsx,.xls","on-change":ie},{tip:a(()=>[...e[35]||(e[35]=[n("div",{class:"el-upload__tip"},"只支持 .xlsx / .xls 文件",-1)])]),default:a(()=>[l(D,{class:"el-icon--upload"},{default:a(()=>[l($(qe))]),_:1}),e[36]||(e[36]=n("div",{class:"el-upload__text"},[u(" 将Excel文件拖到此处，或 "),n("em",null,"点击上传")],-1))]),_:1},512)]),_:1},8,["modelValue"]),l(W,{modelValue:j.value,"onUpdate:modelValue":e[17]||(e[17]=t=>j.value=t),title:"编辑学生信息",width:"500px"},{footer:a(()=>[l(m,{onClick:e[16]||(e[16]=t=>j.value=!1)},{default:a(()=>[...e[41]||(e[41]=[u("取消",-1)])]),_:1}),l(m,{type:"primary",onClick:me},{default:a(()=>[...e[42]||(e[42]=[u("保存",-1)])]),_:1})]),default:a(()=>[l(ge,{model:i,"label-width":"80px"},{default:a(()=>[l(C,{label:"学号"},{default:a(()=>[l(o,{modelValue:i.studentNo,"onUpdate:modelValue":e[9]||(e[9]=t=>i.studentNo=t),disabled:""},null,8,["modelValue"])]),_:1}),l(C,{label:"姓名"},{default:a(()=>[l(o,{modelValue:i.name,"onUpdate:modelValue":e[10]||(e[10]=t=>i.name=t)},null,8,["modelValue"])]),_:1}),l(C,{label:"性别"},{default:a(()=>[l(X,{modelValue:i.gender,"onUpdate:modelValue":e[11]||(e[11]=t=>i.gender=t)},{default:a(()=>[l(Y,{value:"男"},{default:a(()=>[...e[39]||(e[39]=[u("男",-1)])]),_:1}),l(Y,{value:"女"},{default:a(()=>[...e[40]||(e[40]=[u("女",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),l(C,{label:"专业"},{default:a(()=>[l(o,{modelValue:i.major,"onUpdate:modelValue":e[12]||(e[12]=t=>i.major=t)},null,8,["modelValue"])]),_:1}),l(C,{label:"班级"},{default:a(()=>[l(o,{modelValue:i.className,"onUpdate:modelValue":e[13]||(e[13]=t=>i.className=t)},null,8,["modelValue"])]),_:1}),l(C,{label:"年级"},{default:a(()=>[l(o,{modelValue:i.grade,"onUpdate:modelValue":e[14]||(e[14]=t=>i.grade=t)},null,8,["modelValue"])]),_:1}),l(C,{label:"手机号"},{default:a(()=>[l(o,{modelValue:i.phone,"onUpdate:modelValue":e[15]||(e[15]=t=>i.phone=t)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}},zl=we(gl,[["__scopeId","data-v-e1a3328c"]]);export{zl as default};
