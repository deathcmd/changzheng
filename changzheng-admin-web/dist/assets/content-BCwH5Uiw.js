import{_ as _e}from"./_plugin-vue_export-helper-DRcqrMy4.js";/* empty css                        *//* empty css                   *//* empty css                 *//* empty css                        *//* empty css                 *//* empty css                  */import{r as $,a as ye,u as Ue}from"./index-aAsznUlZ.js";import{r as U,a as M,N as be,C as c,D as r,F as l,af as Ve,G as t,L as i,u as h,an as we,K as Te,X as P,V as he,ao as xe,ap as ke,aj as Ce,k as x,ah as Ne,ai as Ee,l as s,W as Ie,al as De,M as Oe,Q as v,H as je,aq as Be,ar as Le,as as A,at as G,au as F,av as S,I as Re,aw as Me,ak as Pe,am as Fe,E as f,y as $e,ag as qe}from"./element-plus-DOarM9kH.js";function K(w){const m=new FormData;return m.append("file",w),$({url:"/content/file/upload/image",method:"post",data:m,headers:{"Content-Type":"multipart/form-data"}})}function He(w){const m=new FormData;return m.append("file",w),$({url:"/content/file/upload/audio",method:"post",data:m,headers:{"Content-Type":"multipart/form-data"}})}function ze(w){const m=new FormData;return m.append("file",w),$({url:"/content/file/upload/video",method:"post",data:m,headers:{"Content-Type":"multipart/form-data"}})}const Ae={class:"node-content"},Ge={class:"page-header"},Se={class:"upload-area"},Ke={key:0,class:"upload-preview"},Qe=["src"],We={class:"upload-area"},Xe={key:0,class:"upload-preview"},Je=["src"],Ye={class:"upload-area"},Ze={key:0,class:"upload-preview"},el=["src"],ll={class:"upload-area"},tl={key:0,class:"upload-preview"},ol=["src"],al={key:0,class:"preview-container"},nl=["src"],dl={key:1,class:"preview-container audio"},il=["src"],rl=["src"],sl={key:2,class:"preview-container article"},ul=["innerHTML"],pl={key:3,class:"preview-container"},ml=["src"],fl={__name:"content",setup(w){const m=ye(),Q=Ue(),C=m.params.id,k=U(!1),O=U(!1),W={1:{id:1,nodeName:"瑞金",mileageThreshold:0},2:{id:2,nodeName:"于都",mileageThreshold:60},3:{id:3,nodeName:"湘江",mileageThreshold:400},4:{id:4,nodeName:"遵义",mileageThreshold:1200},5:{id:5,nodeName:"赤水河",mileageThreshold:1500},6:{id:6,nodeName:"金沙江",mileageThreshold:2500},7:{id:7,nodeName:"泸定桥",mileageThreshold:3500},8:{id:8,nodeName:"夹金山",mileageThreshold:4e3},9:{id:9,nodeName:"草地",mileageThreshold:5e3},10:{id:10,nodeName:"会宁",mileageThreshold:25e3}},X=[{id:1,nodeId:1,contentType:"video",title:"长征出发：从瑞金说起",duration:"8分钟",mediaUrl:"https://example.com/video1.mp4",coverUrl:"",sortOrder:1,autoPlay:!0,enabled:!0},{id:2,nodeId:1,contentType:"article",title:"瑞金：红色故都的历史",duration:"2000字",content:"<h3>瑞金简介</h3><p>瑞金位于江西省东南部，是著名的红色故都、共和国摇篮...</p>",coverUrl:"",sortOrder:2,autoPlay:!1,enabled:!0},{id:3,nodeId:1,contentType:"audio",title:"红军长征歌曲精选",duration:"15分钟",mediaUrl:"https://example.com/audio1.mp3",coverUrl:"",sortOrder:3,autoPlay:!1,enabled:!0}],j=U(!1),T=U(!1),B=U(!1),N=U(!1),q=U(null),L=M({id:C,nodeName:"",mileageThreshold:0}),g=U([]),u=M({}),a=M({id:null,contentType:"video",title:"",duration:"",mediaUrl:"",content:"",coverUrl:"",sortOrder:1,autoPlay:!0,enabled:!0}),J={contentType:[{required:!0,message:"请选择内容类型",trigger:"change"}],title:[{required:!0,message:"请输入标题",trigger:"blur"}]};be(()=>{Y(),Z()});function Y(){const n=W[C];n&&Object.assign(L,n)}function Z(){j.value=!0,setTimeout(()=>{g.value=X.filter(n=>n.nodeId==C),j.value=!1},300)}function ee(){Q.push("/nodes")}function le(n){return{video:"danger",audio:"warning",article:"",image:"success"}[n]||""}function te(n){return{video:"视频",audio:"音频",article:"文章",image:"图片"}[n]||n}function oe(n){return{video:A,audio:G,article:F,image:S}[n]||F}function ae(){N.value=!1,Object.assign(a,{id:null,contentType:"video",title:"",duration:"",mediaUrl:"",content:"",coverUrl:"",sortOrder:g.value.length+1,autoPlay:!0,enabled:!0}),T.value=!0}function ne(n){N.value=!0,Object.assign(a,n),T.value=!0}function de(n){Object.assign(u,n),B.value=!0}async function ie(){var e;if(await((e=q.value)==null?void 0:e.validate())){if(N.value){const d=g.value.findIndex(_=>_.id===a.id);d>-1&&(g.value[d]={...a}),f.success("更新成功")}else g.value.push({...a,id:Date.now(),nodeId:parseInt(C)}),f.success("添加成功");T.value=!1}}function H(n){f.success("更新成功")}function re(n){$e.confirm(`确定删除"${n.title}"吗？`,"提示",{type:"warning"}).then(()=>{g.value=g.value.filter(e=>e.id!==n.id),f.success("删除成功")}).catch(()=>{})}async function R(n,e){k.value=!0;try{let d;e==="video"?d=await ze(n):e==="audio"?d=await He(n):d=await K(n),d.code===200&&d.data?(a.mediaUrl=d.data.url,f.success("上传成功")):f.error(d.message||"上传失败")}catch(d){console.error("上传失败:",d),f.error("上传失败，请检查网络")}finally{k.value=!1}return!1}async function se(n){O.value=!0;try{const e=await K(n);e.code===200&&e.data?(a.coverUrl=e.data.url,f.success("封面上传成功")):f.error(e.message||"上传失败")}catch(e){console.error("封面上传失败:",e),f.error("封面上传失败")}finally{O.value=!1}return!1}return(n,e)=>{const d=Te,_=he,ue=ke,b=Ne,pe=Ee,E=De,me=qe,I=Le,fe=Be,p=je,V=Re,D=Me,ce=Pe,ve=Oe,z=Fe,ge=Ce;return s(),c("div",Ae,[r("div",Ge,[l(d,{onClick:ee,icon:h(we)},{default:t(()=>[...e[14]||(e[14]=[i("返回",-1)])]),_:1},8,["icon"]),r("h2",null,P(L.nodeName)+" - 内容管理",1),l(d,{type:"primary",onClick:ae},{default:t(()=>[l(_,null,{default:t(()=>[l(h(xe))]),_:1}),e[15]||(e[15]=i(" 添加内容 ",-1))]),_:1})]),l(ue,{type:"info",closable:!1,style:{"margin-bottom":"20px"}},{title:t(()=>[e[16]||(e[16]=i(" 当用户里程达到 ",-1)),r("strong",null,P(L.mileageThreshold)+" 公里",1),e[17]||(e[17]=i(" 时，将解锁此节点并自动弹出以下内容供学习 ",-1))]),_:1}),Ve((s(),x(me,{data:g.value,stripe:""},{default:t(()=>[l(b,{prop:"sortOrder",label:"排序",width:"80"}),l(b,{label:"类型",width:"100"},{default:t(({row:o})=>[l(pe,{type:le(o.contentType)},{default:t(()=>[l(_,{style:{"vertical-align":"middle","margin-right":"4px"}},{default:t(()=>[(s(),x(Ie(oe(o.contentType))))]),_:2},1024),i(" "+P(te(o.contentType)),1)]),_:2},1032,["type"])]),_:1}),l(b,{prop:"title",label:"标题","min-width":"200"}),l(b,{prop:"duration",label:"时长/字数",width:"120"}),l(b,{label:"自动播放",width:"100"},{default:t(({row:o})=>[l(E,{modelValue:o.autoPlay,"onUpdate:modelValue":y=>o.autoPlay=y,onChange:y=>H(o)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),l(b,{label:"状态",width:"100"},{default:t(({row:o})=>[l(E,{modelValue:o.enabled,"onUpdate:modelValue":y=>o.enabled=y,onChange:y=>H(o)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),l(b,{label:"操作",width:"200",fixed:"right"},{default:t(({row:o})=>[l(d,{size:"small",onClick:y=>de(o)},{default:t(()=>[...e[18]||(e[18]=[i("预览",-1)])]),_:1},8,["onClick"]),l(d,{size:"small",onClick:y=>ne(o)},{default:t(()=>[...e[19]||(e[19]=[i("编辑",-1)])]),_:1},8,["onClick"]),l(d,{size:"small",type:"danger",onClick:y=>re(o)},{default:t(()=>[...e[20]||(e[20]=[i("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[ge,j.value]]),l(z,{modelValue:T.value,"onUpdate:modelValue":e[12]||(e[12]=o=>T.value=o),title:N.value?"编辑内容":"添加内容",width:"700px"},{footer:t(()=>[l(d,{onClick:e[11]||(e[11]=o=>T.value=!1)},{default:t(()=>[...e[37]||(e[37]=[i("取消",-1)])]),_:1}),l(d,{type:"primary",onClick:ie},{default:t(()=>[...e[38]||(e[38]=[i("确定",-1)])]),_:1})]),default:t(()=>[l(ve,{model:a,rules:J,ref_key:"formRef",ref:q,"label-width":"100px"},{default:t(()=>[l(p,{label:"内容类型",prop:"contentType"},{default:t(()=>[l(fe,{modelValue:a.contentType,"onUpdate:modelValue":e[0]||(e[0]=o=>a.contentType=o)},{default:t(()=>[l(I,{value:"video"},{default:t(()=>[l(_,null,{default:t(()=>[l(h(A))]),_:1}),e[21]||(e[21]=i(" 视频 ",-1))]),_:1}),l(I,{value:"audio"},{default:t(()=>[l(_,null,{default:t(()=>[l(h(G))]),_:1}),e[22]||(e[22]=i(" 音频 ",-1))]),_:1}),l(I,{value:"article"},{default:t(()=>[l(_,null,{default:t(()=>[l(h(F))]),_:1}),e[23]||(e[23]=i(" 文章 ",-1))]),_:1}),l(I,{value:"image"},{default:t(()=>[l(_,null,{default:t(()=>[l(h(S))]),_:1}),e[24]||(e[24]=i(" 图片 ",-1))]),_:1})]),_:1},8,["modelValue"])]),_:1}),l(p,{label:"标题",prop:"title"},{default:t(()=>[l(V,{modelValue:a.title,"onUpdate:modelValue":e[1]||(e[1]=o=>a.title=o),placeholder:"请输入内容标题"},null,8,["modelValue"])]),_:1}),l(p,{label:"时长/字数",prop:"duration"},{default:t(()=>[l(V,{modelValue:a.duration,"onUpdate:modelValue":e[2]||(e[2]=o=>a.duration=o),placeholder:"如：5分钟、1500字",style:{width:"200px"}},null,8,["modelValue"])]),_:1}),a.contentType==="video"?(s(),x(p,{key:0,label:"上传视频",prop:"mediaUrl"},{default:t(()=>[r("div",Se,[l(D,{"show-file-list":!1,"before-upload":o=>R(o,"video"),accept:".mp4,.avi,.mov,.wmv,.flv,.mkv,.webm"},{default:t(()=>[l(d,{type:"primary",loading:k.value},{default:t(()=>[...e[25]||(e[25]=[i("选择视频文件",-1)])]),_:1},8,["loading"])]),_:1},8,["before-upload"]),l(V,{modelValue:a.mediaUrl,"onUpdate:modelValue":e[3]||(e[3]=o=>a.mediaUrl=o),placeholder:"或输入视频链接",style:{"margin-top":"10px"}},{prepend:t(()=>[...e[26]||(e[26]=[i("URL",-1)])]),_:1},8,["modelValue"]),a.mediaUrl?(s(),c("div",Ke,[r("video",{src:a.mediaUrl,controls:"",style:{"max-width":"300px","max-height":"200px"}},null,8,Qe)])):v("",!0)]),e[27]||(e[27]=r("div",{class:"form-tip"},"支持 mp4, avi, mov, wmv, flv, mkv, webm 格式，最大100MB",-1))]),_:1})):v("",!0),a.contentType==="audio"?(s(),x(p,{key:1,label:"上传音频",prop:"mediaUrl"},{default:t(()=>[r("div",We,[l(D,{"show-file-list":!1,"before-upload":o=>R(o,"audio"),accept:".mp3,.wav,.ogg,.m4a,.flac,.aac"},{default:t(()=>[l(d,{type:"primary",loading:k.value},{default:t(()=>[...e[28]||(e[28]=[i("选择音频文件",-1)])]),_:1},8,["loading"])]),_:1},8,["before-upload"]),l(V,{modelValue:a.mediaUrl,"onUpdate:modelValue":e[4]||(e[4]=o=>a.mediaUrl=o),placeholder:"或输入音频链接",style:{"margin-top":"10px"}},{prepend:t(()=>[...e[29]||(e[29]=[i("URL",-1)])]),_:1},8,["modelValue"]),a.mediaUrl?(s(),c("div",Xe,[r("audio",{src:a.mediaUrl,controls:""},null,8,Je)])):v("",!0)]),e[30]||(e[30]=r("div",{class:"form-tip"},"支持 mp3, wav, ogg, m4a, flac, aac 格式，最大100MB",-1))]),_:1})):v("",!0),a.contentType==="image"?(s(),x(p,{key:2,label:"上传图片",prop:"mediaUrl"},{default:t(()=>[r("div",Ye,[l(D,{"show-file-list":!1,"before-upload":o=>R(o,"image"),accept:".jpg,.jpeg,.png,.gif,.webp,.bmp"},{default:t(()=>[l(d,{type:"primary",loading:k.value},{default:t(()=>[...e[31]||(e[31]=[i("选择图片文件",-1)])]),_:1},8,["loading"])]),_:1},8,["before-upload"]),l(V,{modelValue:a.mediaUrl,"onUpdate:modelValue":e[5]||(e[5]=o=>a.mediaUrl=o),placeholder:"或输入图片链接",style:{"margin-top":"10px"}},{prepend:t(()=>[...e[32]||(e[32]=[i("URL",-1)])]),_:1},8,["modelValue"]),a.mediaUrl?(s(),c("div",Ze,[r("img",{src:a.mediaUrl,style:{"max-width":"300px","max-height":"200px"}},null,8,el)])):v("",!0)]),e[33]||(e[33]=r("div",{class:"form-tip"},"支持 jpg, jpeg, png, gif, webp, bmp 格式，最大100MB",-1))]),_:1})):v("",!0),a.contentType==="article"?(s(),x(p,{key:3,label:"文章内容",prop:"content"},{default:t(()=>[l(V,{modelValue:a.content,"onUpdate:modelValue":e[6]||(e[6]=o=>a.content=o),type:"textarea",rows:10,placeholder:"请输入文章内容，支持HTML格式"},null,8,["modelValue"])]),_:1})):v("",!0),l(p,{label:"封面图",prop:"coverUrl"},{default:t(()=>[r("div",ll,[l(D,{"show-file-list":!1,"before-upload":se,accept:".jpg,.jpeg,.png,.gif,.webp"},{default:t(()=>[l(d,{loading:O.value},{default:t(()=>[...e[34]||(e[34]=[i("上传封面",-1)])]),_:1},8,["loading"])]),_:1}),l(V,{modelValue:a.coverUrl,"onUpdate:modelValue":e[7]||(e[7]=o=>a.coverUrl=o),placeholder:"或输入封面图URL",style:{"margin-top":"10px"}},{prepend:t(()=>[...e[35]||(e[35]=[i("URL",-1)])]),_:1},8,["modelValue"]),a.coverUrl?(s(),c("div",tl,[r("img",{src:a.coverUrl,style:{"max-width":"150px","max-height":"100px"}},null,8,ol)])):v("",!0)])]),_:1}),l(p,{label:"排序",prop:"sortOrder"},{default:t(()=>[l(ce,{modelValue:a.sortOrder,"onUpdate:modelValue":e[8]||(e[8]=o=>a.sortOrder=o),min:1,max:100},null,8,["modelValue"])]),_:1}),l(p,{label:"自动播放"},{default:t(()=>[l(E,{modelValue:a.autoPlay,"onUpdate:modelValue":e[9]||(e[9]=o=>a.autoPlay=o)},null,8,["modelValue"]),e[36]||(e[36]=r("span",{class:"form-tip",style:{"margin-left":"10px"}},"开启后，用户解锁节点时自动弹出此内容",-1))]),_:1}),l(p,{label:"启用状态"},{default:t(()=>[l(E,{modelValue:a.enabled,"onUpdate:modelValue":e[10]||(e[10]=o=>a.enabled=o)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),l(z,{modelValue:B.value,"onUpdate:modelValue":e[13]||(e[13]=o=>B.value=o),title:u.title,width:"800px","destroy-on-close":""},{default:t(()=>[u.contentType==="video"?(s(),c("div",al,[r("video",{src:u.mediaUrl,controls:"",style:{width:"100%","max-height":"450px"}},null,8,nl)])):u.contentType==="audio"?(s(),c("div",dl,[r("img",{src:u.coverUrl||"/default-audio-cover.png",class:"audio-cover"},null,8,il),r("audio",{src:u.mediaUrl,controls:"",style:{width:"100%","margin-top":"20px"}},null,8,rl)])):u.contentType==="article"?(s(),c("div",sl,[r("div",{innerHTML:u.content},null,8,ul)])):u.contentType==="image"?(s(),c("div",pl,[r("img",{src:u.mediaUrl,style:{"max-width":"100%"}},null,8,ml)])):v("",!0)]),_:1},8,["modelValue","title"])])}}},Tl=_e(fl,[["__scopeId","data-v-a1679097"]]);export{Tl as default};
